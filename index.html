<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Fichas de Indicadores de Desempenho</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #333;
    }

    header {
      background: #004d7a;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
    }

    header .subtitle {
      font-size: 12px;
      opacity: 0.9;
    }

    main {
      padding: 10px 20px 30px 20px;
    }

    nav {
      margin-top: 10px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    nav button {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #eee;
      cursor: pointer;
      font-size: 13px;
    }

    nav button.active {
      background: #004d7a;
      color: #fff;
      border-color: #004d7a;
    }

    .tab {
      display: none;
      background: #fff;
      padding: 15px;
      border-radius: 4px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
      margin-top: 5px;
    }

    .tab.active {
      display: block;
    }

    h2 {
      margin-top: 0;
      font-size: 16px;
      color: #004d7a;
    }

    h3 {
      margin-top: 15px;
      font-size: 14px;
      color: #004d7a;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 8px;
      flex: 1;
      min-width: 150px;
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 2px;
    }

    input[type="text"],
    input[type="number"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 4px;
      font-size: 12px;
      border-radius: 3px;
      border: 1px solid #ccc;
    }

    textarea {
      min-height: 50px;
      resize: vertical;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 4px;
      vertical-align: top;
    }

    th {
      background: #f0f0f0;
    }

    tr:nth-child(even) {
      background: #fafafa;
    }

    .btn-primary {
      background: #004d7a;
      color: #fff;
      border: 1px solid #004d7a;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-danger {
      background: #b71c1c;
      color: #fff;
      border: 1px solid #b71c1c;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-warning {
      background: #ff9800;
      color: #fff;
      border: 1px solid #ff9800;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-success {
      background: #2e7d32;
      color: #fff;
      border: 1px solid #2e7d32;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    .btn-small {
      padding: 3px 6px;
      font-size: 11px;
    }

    .message {
      font-size: 12px;
      margin: 5px 0;
      padding: 5px;
      border-radius: 3px;
    }

    .message.info {
      background: #e3f2fd;
      color: #0d47a1;
      border: 1px solid #90caf9;
    }

    .message.success {
      background: #e8f5e9;
      color: #1b5e20;
      border: 1px solid #a5d6a7;
    }

    .message.error {
      background: #ffebee;
      color: #b71c1c;
      border: 1px solid #ef9a9a;
    }

    .highlight-final {
      font-weight: bold;
      color: #1b5e20;
    }

    @media print {
      body {
        background: #fff;
      }
      header, nav, .no-print {
        display: none !important;
      }
      main {
        padding: 0;
      }
      table {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>

<header>
  <div>
    <h1>Sistema de Fichas de Indicadores de Desempenho</h1>
    <div class="subtitle">Cadastro de indicadores, metas e relatórios para gestão de desempenho</div>
  </div>
</header>

<main>
  <nav class="no-print">
    <button class="active" data-tab="tab-gestor">GESTOR RESPONSÁVEL</button>
    <button data-tab="tab-admin">ADMIN</button>
    <button data-tab="tab-metas">METAS</button>
    <button data-tab="tab-orientacoes">ORIENTAÇÕES</button>
    <button data-tab="tab-resultados">RESULTADOS</button>
  </nav>

  <!-- ABA GESTOR RESPONSÁVEL -->
  <section id="tab-gestor" class="tab active">
    <h2>Preenchimento da Ficha de Indicadores – Gestor Responsável</h2>

    <div id="gestor-info-msg" class="message info">
      Selecione o seu nome como gestor responsável para visualizar e preencher os indicadores sob sua responsabilidade.
    </div>

    <div class="form-group no-print">
      <label for="gestor-select">Nome do Gestor Responsável</label>
      <select id="gestor-select" onchange="onGestorSelecionado()">
        <option value="">Selecione...</option>
      </select>
    </div>

    <h3>Indicadores sob sua responsabilidade</h3>
    <table id="tabela-gestor-indicadores">
      <thead>
      <tr>
        <th>Perspectiva</th>
        <th>Objetivo Estratégico</th>
        <th>Indicador de desempenho</th>
        <th>Status do detalhamento</th>
        <th class="no-print">Ações</th>
      </tr>
      </thead>
      <tbody>
      <!-- via JS -->
      </tbody>
    </table>

    <hr>

    <h3>Ficha de Indicadores – Detalhamento Técnico</h3>
    <form id="form-gestor-indicador" onsubmit="event.preventDefault();">
      <input type="hidden" id="gestor-indicador-id">

      <div class="row">
        <div class="form-group">
          <label>Perspectiva</label>
          <input type="text" id="gestor-perspectiva-nome" disabled>
        </div>
        <div class="form-group">
          <label>Objetivo Estratégico</label>
          <input type="text" id="gestor-objetivo-nome" disabled>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label>Indicador de desempenho</label>
          <input type="text" id="gestor-indicador-nome" disabled>
        </div>
        <div class="form-group">
          <label>Unidade de medida do indicador</label>
          <input type="text" id="gestor-unidade" placeholder="Ex.: %, R$, número de ocorrências, índice composto etc.">
        </div>
      </div>

      <div class="form-group">
        <label>Descrição operacional do indicador</label>
        <textarea id="gestor-descricao" placeholder="Explique o que o indicador mede, qual a lógica e o contexto de uso."></textarea>
      </div>

      <div class="form-group">
        <label>Fórmula de cálculo do indicador</label>
        <textarea id="gestor-formula" placeholder="Descreva a fórmula de cálculo – numerador, denominador, multiplicadores, filtros etc."></textarea>
      </div>

      <div class="row">
        <div class="form-group">
          <label>Fonte dos dados</label>
          <input type="text" id="gestor-fonte" placeholder="Sistema, planilha, relatório, base de dados etc.">
        </div>
        <div class="form-group">
          <label>Periodicidade de apuração</label>
          <input type="text" id="gestor-periodicidade" placeholder="Mensal, trimestral, anual, evento etc.">
        </div>
        <div class="form-group">
          <label>Polaridade (quanto maior / menor, melhor)</label>
          <input type="text" id="gestor-polaridade" placeholder="Ex.: Quanto maior melhor / Quanto menor melhor / Faixa ideal etc.">
        </div>
      </div>

      <div id="gestor-form-msg" class="message info no-print">
        Selecione um indicador da lista para preencher ou editar os detalhes técnicos.
      </div>

      <div class="no-print" style="margin-top: 10px;">
        <button type="button" class="btn-secondary" onclick="salvarIndicadorGestor('draft')">Salvar rascunho</button>
        <button type="button" class="btn-success" onclick="salvarIndicadorGestor('final')">
          SALVAR DEFINITIVO (TRAVAR INDICADORES)
        </button>
        <button type="button" class="btn-secondary" onclick="limparFormularioGestor()">Limpar formulário</button>
      </div>

      <p class="message info no-print" style="margin-top: 10px;">
        Atenção: ao salvar como <strong>definitivo</strong>, os indicadores sob sua responsabilidade
        ficarão bloqueados para edição. A liberação para nova edição somente poderá ser feita pelo ADMIN.
      </p>
    </form>
  </section>

  <!-- ABA ADMIN -->
  <section id="tab-admin" class="tab">
    <h2>Administração do Sistema – Cadastro de Estrutura</h2>

    <div class="message info">
      Esta área é restrita ao administrador do sistema. Utilize a senha de ADMIN para cadastrar e manter gestores,
      perspectivas, objetivos e indicadores, bem como para liberar edições já travadas.
    </div>

    <div class="row no-print">
      <div class="form-group">
        <label for="admin-password">Senha do ADMIN</label>
        <input type="password" id="admin-password" placeholder="Informe a senha de administração">
      </div>
      <div class="form-group" style="margin-top: 18px;">
        <button class="btn-primary" onclick="loginAdmin()">Entrar / Revalidar senha</button>
        <button class="btn-secondary" onclick="logoutAdmin()">Sair do ADMIN</button>
      </div>
    </div>

    <div id="admin-login-msg" class="message info no-print">
      Para cadastrar ou editar gestores, perspectivas, objetivos e indicadores, é necessário autenticar-se como ADMIN.
    </div>

    <div id="admin-protected" style="display:none;">
      <hr>
      <h3>Cadastro de Gestores Responsáveis</h3>
      <div class="row">
        <div class="form-group">
          <label for="gestor-nome-admin">Nome do Gestor</label>
          <input type="text" id="gestor-nome-admin">
        </div>
        <div class="form-group" style="margin-top: 18px;">
          <button id="btn-add-gestor" class="btn-primary" onclick="adicionarGestor()">Adicionar Gestor</button>
        </div>
      </div>

      <table id="tabela-gestores">
        <thead>
        <tr>
          <th>Nome do Gestor</th>
          <th class="no-print">Ações</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>

      <hr>

      <h3>Cadastro de Perspectivas</h3>
      <div class="row">
        <div class="form-group">
          <label for="perspectiva-nome">Nome da Perspectiva</label>
          <input type="text" id="perspectiva-nome" placeholder="Ex.: Financeira, Clientes e Mercado, Processos, Pessoas etc.">
        </div>
        <div class="form-group" style="margin-top: 18px;">
          <button id="btn-add-perspectiva" class="btn-primary" onclick="adicionarPerspectiva()">Adicionar Perspectiva</button>
        </div>
      </div>

      <table id="tabela-perspectivas">
        <thead>
        <tr>
          <th>Nome da Perspectiva</th>
          <th class="no-print">Ações</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>

      <hr>

      <h3>Cadastro de Objetivos Estratégicos</h3>
      <div class="row">
        <div class="form-group">
          <label for="objetivo-perspectiva-select">Perspectiva</label>
          <select id="objetivo-perspectiva-select">
            <option value="">Selecione...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="objetivo-gestor-select">Gestor responsável</label>
          <select id="objetivo-gestor-select">
            <option value="">Selecione...</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="objetivo-nome">Nome do Objetivo Estratégico</label>
          <input type="text" id="objetivo-nome" placeholder="Iniciar com verbo de ação, ex.: Aumentar, Desenvolver, Aprimorar etc.">
        </div>
        <div class="form-group" style="margin-top: 18px;">
          <button id="btn-add-objetivo" class="btn-primary" onclick="adicionarObjetivo()">Adicionar Objetivo</button>
        </div>
      </div>

      <table id="tabela-objetivos">
        <thead>
        <tr>
          <th>Perspectiva</th>
          <th>Objetivo Estratégico</th>
          <th>Gestor Responsável</th>
          <th class="no-print">Ações</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>

      <hr>

      <h3>Cadastro de Indicadores de Desempenho</h3>
      <div class="row">
        <div class="form-group">
          <label for="indicador-perspectiva-select">Perspectiva</label>
          <select id="indicador-perspectiva-select" onchange="onPerspectivaIndicadorChange()">
            <option value="">Selecione...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="indicador-objetivo-select">Objetivo Estratégico</label>
          <select id="indicador-objetivo-select">
            <option value="">Selecione...</option>
          </select>
        </div>
        <div class="form-group">
          <label for="indicador-gestor-select-admin">Gestor Responsável</label>
          <select id="indicador-gestor-select-admin">
            <option value="">Selecione...</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="indicador-nome-admin">Nome do Indicador de Desempenho</label>
          <input type="text" id="indicador-nome-admin" placeholder="Ex.: Faturamento, EBITDA, Taxa de Conversão, NPS, etc.">
        </div>
        <div class="form-group" style="margin-top: 18px;">
          <button id="btn-add-indicador" class="btn-primary" onclick="adicionarIndicador()">Adicionar Indicador</button>
        </div>
      </div>

      <table id="tabela-admin-indicadores">
        <thead>
        <tr>
          <th>Perspectiva</th>
          <th>Objetivo Estratégico</th>
          <th>Indicador de Desempenho</th>
          <th>Gestor Responsável</th>
          <th>Status do Detalhamento</th>
          <th class="no-print">Ações</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>

      <hr>

      <h3>Cadastro de Metas dos Indicadores (ADMIN)</h3>
      <p class="message info">
        Consulta e controle das metas dos indicadores. A edição ou exclusão de metas definitivas exige liberação com senha do ADMIN.
      </p>
      <table id="tabela-admin-metas">
        <thead>
        <tr>
          <th>Perspectiva</th>
          <th>Objetivo Estratégico</th>
          <th>Indicador</th>
          <th>Gestor Responsável</th>
          <th>Ano das metas</th>
          <th>Tipo de cálculo</th>
          <th>Status das metas</th>
          <th class="no-print">Ações (ADMIN)</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>

      <hr>

      <div class="row no-print">
        <div class="form-group">
          <label for="admin-new-password">Alterar senha do ADMIN</label>
          <input type="password" id="admin-new-password" placeholder="Nova senha">
        </div>
        <div class="form-group" style="margin-top: 18px;">
          <button id="btn-alterar-senha" class="btn-warning" onclick="alterarSenhaAdmin()">Alterar senha</button>
        </div>
      </div>

      <div class="no-print" style="margin-top: 10px;">
        <button id="btn-validar-cadastro" class="btn-success" onclick="validarCadastro()">
          Validar cadastro (encerrar sessão de administração)
        </button>
      </div>

      <div id="admin-validacao-msg" class="message info" style="margin-top: 10px;">
        Utilize esta opção após concluir cadastros e ajustes, para retornar o sistema ao modo de uso normal.
      </div>
    </div>
  </section>

  <!-- ABA METAS -->
  <section id="tab-metas" class="tab">
    <h2>Cadastro de Metas dos Indicadores</h2>

    <div id="metas-msg" class="message info">
      Selecione o gestor responsável, escolha um indicador e registre as metas anuais, faixas de gestão à vista e valores de referência.
    </div>

    <div class="form-group no-print">
      <label for="gestor-metas-select">Nome do Gestor Responsável</label>
      <select id="gestor-metas-select" onchange="onGestorMetasSelecionado()">
        <option value="">Selecione...</option>
      </select>
    </div>

    <div class="no-print">
      <h3>Indicadores sob sua responsabilidade</h3>
      <table id="tabela-metas-indicadores">
        <thead>
        <tr>
          <th>Perspectiva</th>
          <th>Objetivo Estratégico</th>
          <th>Indicador</th>
          <th>Status das metas</th>
          <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <!-- via JS -->
        </tbody>
      </table>
    </div>

    <hr class="no-print">

    <h3>Ficha de Metas do Indicador</h3>
    <form id="form-metas" onsubmit="event.preventDefault();">
      <input type="hidden" id="meta-id">
      <input type="hidden" id="meta-indicador-id">

      <div class="row">
        <div class="form-group">
          <label>Perspectiva</label>
          <input type="text" id="meta-perspectiva-nome" disabled>
        </div>
        <div class="form-group">
          <label>Objetivo Estratégico</label>
          <input type="text" id="meta-objetivo-nome" disabled>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label>Indicador de desempenho</label>
          <input type="text" id="meta-indicador-nome" disabled>
        </div>
        <div class="form-group">
          <label>Unidade de medida do indicador</label>
          <input type="text" id="meta-unidade" disabled>
        </div>
      </div>

      <div class="form-group">
        <label for="meta-ano">Ano de monitoramento (ano das metas)</label>
        <input type="number" id="meta-ano" min="1900" max="9999" onchange="atualizarAnosReferenciaMetas()">
      </div>

      <div class="form-group">
        <label>Metas mensais para o ano
          <span style="font-weight: normal;">(unidade: <span id="meta-unidade-label"></span>)</span>
        </label>

        <div class="row">
          <div class="form-group">
            <label for="meta-jan">Jan</label>
            <input type="text" id="meta-jan">
          </div>
          <div class="form-group">
            <label for="meta-fev">Fev</label>
            <input type="text" id="meta-fev">
          </div>
          <div class="form-group">
            <label for="meta-mar">Mar</label>
            <input type="text" id="meta-mar">
          </div>
          <div class="form-group">
            <label for="meta-abr">Abr</label>
            <input type="text" id="meta-abr">
          </div>
          <div class="form-group">
            <label for="meta-mai">Mai</label>
            <input type="text" id="meta-mai">
          </div>
          <div class="form-group">
            <label for="meta-jun">Jun</label>
            <input type="text" id="meta-jun">
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label for="meta-jul">Jul</label>
            <input type="text" id="meta-jul">
          </div>
          <div class="form-group">
            <label for="meta-ago">Ago</label>
            <input type="text" id="meta-ago">
          </div>
          <div class="form-group">
            <label for="meta-set">Set</label>
            <input type="text" id="meta-set">
          </div>
          <div class="form-group">
            <label for="meta-out">Out</label>
            <input type="text" id="meta-out">
          </div>
          <div class="form-group">
            <label for="meta-nov">Nov</label>
            <input type="text" id="meta-nov">
          </div>
          <div class="form-group">
            <label for="meta-dez">Dez</label>
            <input type="text" id="meta-dez">
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="meta-tipo-calculo">Tipo de cálculo do indicador</label>
        <select id="meta-tipo-calculo">
          <option value="">Selecione...</option>
          <option value="mensal">1. Indicador Mensal (mês isolado)</option>
          <option value="acum_soma">2. Indicador Acumulado (YTD) – soma</option>
          <option value="acum_media">2. Indicador Acumulado (YTD) – média</option>
        </select>
      </div>

      <div class="form-group">
        <label>Faixas de gestão à vista (em % de atingimento da meta)</label>
        <div class="row">
          <div class="form-group">
            <label for="meta-azul-de">Azul: de</label>
            <input type="text" id="meta-azul-de" placeholder="Ex.: 100,00">
          </div>
          <div class="form-group">
            <label for="meta-azul-ate">Azul: até</label>
            <input type="text" id="meta-azul-ate" placeholder="Ex.: 110,00">
          </div>
          <div class="form-group">
            <label for="meta-verde-de">Verde: de</label>
            <input type="text" id="meta-verde-de" placeholder="Ex.: 90,00">
          </div>
          <div class="form-group">
            <label for="meta-verde-ate">Verde: até</label>
            <input type="text" id="meta-verde-ate" placeholder="Ex.: 99,99">
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <label for="meta-amarelo-de">Amarelo: de</label>
            <input type="text" id="meta-amarelo-de" placeholder="Ex.: 80,00">
          </div>
          <div class="form-group">
            <label for="meta-amarelo-ate">Amarelo: até</label>
            <input type="text" id="meta-amarelo-ate" placeholder="Ex.: 89,99">
          </div>
          <div class="form-group">
            <label for="meta-vermelho-abaixo">Vermelho: abaixo de</label>
            <input type="text" id="meta-vermelho-abaixo" placeholder="Ex.: 80,00">
          </div>
        </div>
        <p style="font-size: 12px; margin-top: 4px;">
          As faixas não podem ter sobreposição. Utilize valores crescentes e coerentes com a lógica de atingimento das metas.
        </p>
      </div>

      <div class="form-group">
        <label>Valores de referência (últimos 3 anos em relação ao ano de monitoramento) – opcional</label>
        <p style="font-size: 12px; margin-top: 4px;">
          Utilize os valores realizados do indicador nos últimos 3 anos, para auxiliar na definição e análise das metas.
        </p>
        <div class="row">
          <div class="form-group">
            <label>Valor ano <span id="meta-ref-ano1"></span></label>
            <input type="text" id="meta-ref1">
          </div>
          <div class="form-group">
            <label>Valor ano <span id="meta-ref-ano2"></span></label>
            <input type="text" id="meta-ref2">
          </div>
          <div class="form-group">
            <label>Valor ano <span id="meta-ref-ano3"></span></label>
            <input type="text" id="meta-ref3">
          </div>
        </div>
      </div>

      <div id="metas-form-msg" class="message info no-print">
        Selecione um indicador da lista para cadastrar ou editar as metas anuais.
      </div>

      <div class="no-print" style="margin-top: 10px;">
        <button type="button" class="btn-secondary" onclick="salvarMeta('draft')">Salvar rascunho de metas</button>
        <button type="button" class="btn-success" onclick="salvarMeta('final')">
          SALVAR DEFINITIVO DAS METAS
        </button>
        <button type="button" class="btn-secondary" onclick="limparFormularioMetas()">Limpar formulário de metas</button>
      </div>
    </form>

    <hr>

    <h3>Relatório das Metas Cadastradas</h3>
    <div class="no-print">
      <div class="row">
        <div class="form-group">
          <label for="filtro-metas-perspectiva">Filtrar por Perspectiva</label>
          <select id="filtro-metas-perspectiva" onchange="renderTabelaRelatorioMetas()">
            <option value="">Todas</option>
          </select>
        </div>
        <div class="form-group">
          <label for="filtro-metas-objetivo">Filtrar por Objetivo Estratégico</label>
          <select id="filtro-metas-objetivo" onchange="renderTabelaRelatorioMetas()">
            <option value="">Todos</option>
          </select>
        </div>
        <div class="form-group">
          <label for="filtro-metas-indicador">Filtrar por Indicador</label>
          <select id="filtro-metas-indicador" onchange="renderTabelaRelatorioMetas()">
            <option value="">Todos</option>
          </select>
        </div>
      </div>

      <div style="margin: 10px 0;">
        <button class="btn-secondary" onclick="window.print()">Imprimir / Exportar PDF</button>
        <button class="btn-primary" onclick="exportarMetasCSV()">Exportar metas para Excel (CSV)</button>
      </div>
    </div>

    <table id="tabela-relatorio-metas">
      <thead>
      <tr>
        <th>Perspectiva</th>
        <th>Objetivo Estratégico</th>
        <th>Indicador</th>
        <th>Gestor Responsável</th>
        <th>Ano das metas</th>
        <th>Tipo de cálculo</th>
        <th>Jan</th>
        <th>Fev</th>
        <th>Mar</th>
        <th>Abr</th>
        <th>Mai</th>
        <th>Jun</th>
        <th>Jul</th>
        <th>Ago</th>
        <th>Set</th>
        <th>Out</th>
        <th>Nov</th>
        <th>Dez</th>
        <th>Faixas de gestão à vista</th>
        <th>Valores de referência (últimos 3 anos)</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody>
      <!-- via JS -->
      </tbody>
    </table>
  </section>

  <!-- ABA ORIENTAÇÕES (mantida igual à sua versão anterior, não repito aqui por brevidade) -->
  <!-- ... -->

  <!-- ABA RESULTADOS (mantida igual à sua versão anterior, não repito aqui por brevidade) -->
  <!-- ... -->

</main>

<script>
  // ==========================
  // DADOS E PERSISTÊNCIA
  // ==========================
  const STORAGE_KEY = 'sistemaIndicadoresV2';

  let appData = {
    adminPassword: 'admin123',
    perspectives: [],
    objectives: [],
    managers: [],
    indicators: [],
    metas: []
  };

  async function carregarDados() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try {
        const parsed = JSON.parse(raw);
        appData = Object.assign(appData, parsed);
        return;
      } catch (e) {
        console.error('Erro ao carregar dados do localStorage, tentando carregar estrutura padrão.', e);
      }
    }

    try {
      const response = await fetch('appData.json', { cache: 'no-store' });
      if (response.ok) {
        const defaultData = await response.json();
        if (defaultData && typeof defaultData === 'object') {
          appData = Object.assign(appData, defaultData);
          salvarDados(); // grava no localStorage do usuário
          console.log('Dados iniciais carregados de appData.json.');
        }
      } else {
        console.warn('appData.json não encontrado ou inacessível. O sistema iniciará com estrutura vazia.');
      }
    } catch (e) {
      console.error('Erro ao carregar appData.json. O sistema iniciará com estrutura vazia.', e);
    }
  }

  function salvarDados() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
  }

  function gerarId() {
    return 'ID' + Date.now().toString(36) + Math.random().toString(36).substring(2, 10);
  }

  let adminLogado = false;

  // (DAQUI EM DIANTE permanecem todas as funções que já existiam: 
  // loginAdmin, logoutAdmin, updateAdminEditingUI, adicionarGestor, 
  // adicionarPerspectiva, adicionarObjetivo, adicionarIndicador, 
  // salvarIndicadorGestor, todas as funções de METAS, relatórios etc.
  // Não alterei essas partes.)

  // ==========================
  // INICIALIZAÇÃO
  // ==========================
  async function iniciarAplicativo() {
    await carregarDados();
    updateAdminEditingUI();
    renderTabelaGestores();
    atualizarCombosGestores();
    atualizarGestorSelectGestorTab();
    renderTabelaPerspectivas();
    atualizarCombosPerspectivas();
    renderTabelaObjetivos();
    atualizarObjetivosSelectAdminIndicadores();
    atualizarCombosFiltrosResultados();
    renderTabelaGestorIndicadores();
    renderTabelaAdminIndicadores();
    renderTabelaResultados();

    // METAS
    atualizarGestorMetasSelect();
    renderTabelaMetasIndicadores();
    renderTabelaAdminMetas();
    atualizarCombosFiltrosMetas();
    renderTabelaRelatorioMetas();
  }

  iniciarAplicativo();
</script>

</body>
</html>
